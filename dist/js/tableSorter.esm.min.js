export class tableSorter{constructor(t){if(t.filters.length>Object.keys(t.dataSet[0]).length)return document.querySelector("body").innerHTML=`<div>Filter length is larger ( <b>${t.filters.length}</b> ${JSON.stringify(t.filters)}) then the \n\t\t\tdataset key length ( <b>${Object.keys(t.dataSet[0]).length}</b> ${JSON.stringify(Object.keys(t.dataSet[0]))})</div>`,!1;this.obj=t,this.cols=[],this.sort={orderBy:0,way:"asc",lastOrder:[0,0]},Object.keys(this.obj.dataSet[0]).forEach((t=>{this.cols.push(t)})),this.table=document.createElement("table"),this.table.setAttribute("id",t.tableId),this.table.classList.add("tableSorter"),this.thead=document.createElement("thead"),this.tbody=document.createElement("tbody");const e=document.createElement("tr");t.header.forEach(((t,s)=>{const n=document.createElement("th");n.innerHTML=`${t} <i class="sorterIcon"></i>`,n.setAttribute("data",`cell_${s}`),e.appendChild(n)})),this.thead.appendChild(e),this.table.appendChild(this.thead),this.table.appendChild(this.tbody),document.querySelector(t.target).appendChild(this.table);let s=document.createElement("div");s.classList.add("wrapper"),s.append(this.table),document.querySelector(t.target).appendChild(s),this.th=this.thead.getElementsByTagName("th"),this.columnsToShow=[],this.currentPage=0,this.pageLength=10,this.columns=[],this.conditions={},this.drawFooter(),this.drawRows(),this.controls(),this.sorting()}drawFooter(){const t=this.columns,e=this.conditions,s=this.columnsToShow,n=this.table.createTFoot().insertRow(0);for(let t=0;t<this.th.length;t++){s.push(this.th[t].getAttribute("data"));const e=n.insertCell();this.obj.filters.includes(t)&&(e.innerHTML=`<input class="form-control" data-index="${this.columnsToShow[t]}" placeholder="...">`,e.addEventListener("keyup",(t=>{this.drawRows(event),this.controls()})))}this.obj.filters.forEach((function(n){t.push(s[n]),e[`cell_${n}`]=""}))}filter=function(t){this.status_;let e=this.conditions;if(null!=t){let s=t.target.value,n=t.target.getAttribute("data-index");e[n]=s}const s=this.cols;this.result=this.obj.dataSet.filter((function(t){const n=[];if(Object.keys(e).forEach((function(i,r){const a=e[i].toLowerCase(),o=/^\d+$/.test(t[s[r]]);if(!0===o&&(a.startsWith(">=")||a.startsWith(">")||a.startsWith("<=")||a.startsWith("<"))){if(a.startsWith(">=")){const e=a.split(">=").join("");n.push(parseInt(t[s[r]])>=e)}else if(a.startsWith(">")){const e=a.split(">").join("");n.push(parseInt(t[s[r]])>e)}else if(a.startsWith("<=")){const e=a.split("<=").join("");n.push(parseInt(t[s[r]])<=e)}else if(a.startsWith("<")){const e=a.split("<").join("");n.push(parseInt(t[s[r]])<e)}}else if(!1===o)n.push(t[s[r]].toLowerCase().includes(a));else{const e=String(t[s[r]]);n.push(e.includes(a))}})),1==n.every((function(t){return 1==t})))return t}));let n=[],i=this.currentPage,r=parseInt(this.pageLength);return this.result.forEach((function(t,e){e>=i*r&&e<r*i+r&&n.push(t)})),n};drawRows(t){let e=null;void 0!==t&&(e=t);let s=this.filter(e);this.columnsToShow;this.tbody.innerHTML="";const n=this.tbody,i=this.obj;s.forEach((function(t,e){const s=document.createElement("tr");!0===i.striped&&s.classList.add(e%2==0?"even":"odd"),Object.keys(t).forEach(((e,n)=>{const i=document.createElement("td");i.classList.add(`cell_${n}`),i.textContent=t[e],s.appendChild(i)})),n.appendChild(s)}))}controls(){this.table.parentNode.querySelectorAll(".dataTableControls").length>0&&(this.table.parentNode.querySelectorAll(".dataTableControls")[0].remove(),this.table.parentNode.querySelectorAll(".pageLength")[0].remove());let t=document.createElement("select");t.classList.add("pageLength");let e=document.createElement("option");e.setAttribute("value",10),e.textContent=10,t.append(e);let s=document.createElement("option");s.setAttribute("value",25),s.textContent=25,e.addEventListener("click",(t=>{this.PageLength(t.target.value)})),t.append(s);let n=document.createElement("option");n.setAttribute("value",99999999),n.textContent="All",e.addEventListener("click",(t=>{this.PageLength(t.target.value)})),t.append(n),this.table.parentNode.prepend(t),t.addEventListener("change",(t=>{this.PageLength(t.target.value)})),25==this.pageLength?s.setAttribute("selected",!0):99999999==this.pageLength?n.setAttribute("selected",!0):e.setAttribute("selected",!0);let i=document.createElement("div");i.classList.add("dataTableControls");for(let t=0;t<Math.ceil(this.result.length/this.pageLength);t++){let e=document.createElement("Button");e.textContent=t+1,t==this.currentPage&&e.classList.add("active"),e.addEventListener("click",(t=>{this.Page(t.target.textContent-1)})),i.append(e)}this.table.after(i)}sorting(){this.thead.querySelectorAll("th").forEach((t=>{t.addEventListener("click",(()=>{document.querySelectorAll(".sorterIcon").forEach((t=>{t.innerHTML=""}));const e=parseInt(t.getAttribute("data").split("cell_").join(""));this.sort.orderBy==e?(this.sort.lastOrder[0],this.sort.lastOrder[1],this.sort.way="asc"==this.sort.way?"desc":"asc"):this.sort.way="asc",t.querySelector(".sorterIcon").innerHTML="asc"==this.sort.way?"\t&uarr;":"&darr;",this.sort.orderBy=e,this.sort.lastOrder.shift(),this.sort.lastOrder.push(e);const s=[];for(let t=Object.keys(this.obj.dataSet).length-1;t>=0;t--)s.push(this.obj.dataSet[t]);this.obj.dataSet=s,this.drawRows()}))}))}PageLength=function(t){this.currentPage=0,this.pageLength=t,this.drawRows(),this.controls()};Page=function(t){this.currentPage=t,this.drawRows(),this.controls()}}