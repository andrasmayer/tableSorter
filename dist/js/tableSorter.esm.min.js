export class tableSorter{constructor(t){let e=document.querySelector("body"),s="";if(null==t.dataSet&&(s+="<div>Your dataSet is empty</div>"),""!=s)return e.innerHTML=s,!1;this.obj=t,this.cols=[],this.sort={orderBy:0,way:"asc",lastOrder:[0,0]},Object.keys(this.obj.dataSet[0]).forEach(t=>{this.cols.push(t)}),this.table=document.createElement("table"),this.table.setAttribute("id",t.tableId),this.table.classList.add("tableSorter"),this.thead=document.createElement("thead"),this.tbody=document.createElement("tbody");let i=document.createElement("tr");t.header.forEach((t,e)=>{let s=document.createElement("th");s.innerHTML=`${t} <i class="sorterIcon"></i>`,s.setAttribute("data",`cell_${e}`),i.appendChild(s)}),this.thead.appendChild(i),this.table.appendChild(this.thead),this.table.appendChild(this.tbody),document.querySelector(t.target).appendChild(this.table);let a=document.createElement("div");a.classList.add("wrapper"),a.append(this.table),document.querySelector(t.target).appendChild(a),this.th=this.thead.getElementsByTagName("th"),this.columnsToShow=[],this.currentPage=0,this.pageLength=10,this.columns=[],this.conditions={},this.drawFooter(),this.drawRows(),this.controls(),this.sorting()}drawFooter(){let t=this.columns,e=this.conditions,s=this.columnsToShow,i=this.table.createTFoot(),a=i.insertRow(0);for(let r=0;r<this.th.length;r++){s.push(this.th[r].getAttribute("data"));let l=a.insertCell();!0==this.obj.filters&&(l.innerHTML=`<input class="form-control" style="width:${l.clientWidth}px;" data-index="${this.columnsToShow[r]}" placeholder="${this.th[r].textContent}..">`,l.addEventListener("keyup",t=>{this.drawRows(event),this.controls()}))}Object.keys(this.obj.dataSet[0]).forEach((s,i)=>{t.push(s),e[`cell_${i}`]=""})}filter=function(t){this.status_;let e=this.conditions;if(null!=t){let s=t.target.value;e[t.target.getAttribute("data-index")]=s}let i=this.cols;this.result=this.obj.dataSet.filter(function(t){let s=[];if(Object.keys(e).forEach(function(a,r){let l=e[a].toLowerCase(),h=/^\d.+$/.test(t[i[r]]);if(!0===h&&(l.startsWith(">=")||l.startsWith(">")||l.startsWith("<=")||l.startsWith("<"))){if(l.startsWith(">=")){let n=l.split(">=").join("");s.push(parseInt(t[i[r]])>=n)}else if(l.startsWith(">")){let o=l.split(">").join("");s.push(parseInt(t[i[r]])>o)}else if(l.startsWith("<=")){let d=l.split("<=").join("");s.push(parseInt(t[i[r]])<=d)}else if(l.startsWith("<")){let c=l.split("<").join("");s.push(parseInt(t[i[r]])<c)}}else if(!1===h)s.push(t[i[r]].toLowerCase().includes(l));else{let u=String(t[i[r]]);s.push(u.includes(l))}}),!0==s.every(function(t){return!0==t}))return t});let a=[],r=this.currentPage,l=parseInt(this.pageLength);return this.result.forEach(function(t,e){e>=r*l&&e<l*r+l&&a.push(t)}),a};drawRows(t){let e=null;void 0!==t&&(e=t);let s=this.filter(e);this.columnsToShow,this.tbody.innerHTML="";let i=this.tbody,a=this.obj;s.forEach(function(t,e){let s=document.createElement("tr");!0===a.striped&&s.classList.add(e%2==0?"even":"odd"),Object.keys(t).forEach((e,i)=>{let a=document.createElement("td");a.classList.add(`cell_${i}`),a.textContent=t[e],s.appendChild(a)}),i.appendChild(s)})}controls(){this.table.parentNode.querySelectorAll(".dataTableControls").length>0&&(this.table.parentNode.querySelectorAll(".dataTableControls")[0].remove(),this.table.parentNode.querySelectorAll(".pageLength")[0].remove());let t=document.createElement("select");t.classList.add("pageLength");let e=document.createElement("option");e.setAttribute("value",10),e.textContent=10,t.append(e);let s=document.createElement("option");s.setAttribute("value",25),s.textContent=25,e.addEventListener("click",t=>{this.PageLength(t.target.value)}),t.append(s);let i=document.createElement("option");i.setAttribute("value",99999999),i.textContent="All",e.addEventListener("click",t=>{this.PageLength(t.target.value)}),t.append(i),this.table.parentNode.prepend(t),t.addEventListener("change",t=>{this.PageLength(t.target.value)}),25==this.pageLength?s.setAttribute("selected",!0):99999999==this.pageLength?i.setAttribute("selected",!0):e.setAttribute("selected",!0);let a=document.createElement("div");a.classList.add("dataTableControls");for(let r=0;r<Math.ceil(this.result.length/this.pageLength);r++){let l=document.createElement("Button");l.textContent=r+1,r==this.currentPage&&l.classList.add("active"),l.addEventListener("click",t=>{this.Page(t.target.textContent-1)}),a.append(l)}this.table.after(a)}sorting(){this.thead.querySelectorAll("th").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".sorterIcon").forEach(t=>{t.innerHTML=""});let e=parseInt(t.getAttribute("data").split("cell_").join(""));this.sort.orderBy==e?(this.sort.lastOrder[0],this.sort.lastOrder[1],this.sort.way="asc"==this.sort.way?"desc":"asc"):this.sort.way="asc",t.querySelector(".sorterIcon").innerHTML="asc"==this.sort.way?"	&uarr;":"&darr;",this.sort.orderBy=e,this.sort.lastOrder.shift(),this.sort.lastOrder.push(e);let s=[],i=Object.keys(this.obj.dataSet).length;for(let a=i-1;a>=0;a--)s.push(this.obj.dataSet[a]);this.obj.dataSet=s,this.drawRows()})})}PageLength=function(t){this.currentPage=0,this.pageLength=t,this.drawRows(),this.controls()};Page=function(t){this.currentPage=t,this.drawRows(),this.controls()}}